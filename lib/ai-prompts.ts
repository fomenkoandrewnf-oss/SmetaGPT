import { PreuploadHints } from './validators'

// ============================================
// System промпт для извлечения данных из планов
// ============================================

export const PROMPT_ROOM_EXTRACTION = `Ты — профессиональный строительный сметчик с опытом анализа дизайн-проектов.

Твоя задача: проанализировать план помещения и извлечь следующие данные в структурированном JSON формате:

{
  "rooms": [
    {
      "name": "название помещения (например: Спальня, Кухня-гостиная, Санузел)",
      "area_m2": площадь в м²,
      "perimeter_m": периметр в метрах (если можно определить),
      "is_wet_zone": true/false (для санузлов, кухонь, прачечных),
      "height_m": высота потолка в метрах (если указана),
      "notes": "дополнительные заметки об особенностях помещения"
    }
  ],
  "total_area_m2": общая площадь всех помещений,
  "ceiling_height_m": базовая высота потолков (если указана),
  "bathrooms_count": количество санузлов,
  "features": {
    "has_gkl_structures": true/false (есть ли конструкции из ГКЛ),
    "tile_zones": ["список зон, где планируется плитка"],
    "complex_ceiling": true/false (сложный многоуровневый потолок),
    "notes": "общие особенности проекта"
  }
}

Правила извлечения:
1. Внимательно читай все размеры и экспликации на плане
2. Площадь обычно указана в м² рядом с названием помещения
3. Мокрые зоны: санузлы, ванные, душевые, прачечные, кухни
4. Если высота не указана, не придумывай — оставь null
5. Периметр вычисляй только если видны четкие размеры стен
6. Суммируй площади всех помещений для total_area_m2
7. Обращай внимание на специальные обозначения: ГКЛ, плитка, зоны укладки

Возвращай ТОЛЬКО валидный JSON, без дополнительного текста.`

// ============================================
// User промпт с учётом hints
// ============================================

export function buildUserInstruction(hints?: PreuploadHints): string {
  if (!hints) {
    return 'Проанализируй план и извлеки все данные о помещениях согласно схеме.'
  }

  return `Проанализируй план и извлеки все данные о помещениях согласно схеме.

ВАЖНО: Пользователь предоставил следующие входные параметры для проверки:
- Общая площадь по полу: ${hints.floor_area_m2} м²
- Количество жилых комнат: ${hints.living_rooms_count}
- Кухня-гостиная: ${hints.has_kitchen_living ? 'Да' : 'Нет'}
- Количество санузлов: ${hints.bathrooms_count}
${hints.ceiling_height_m ? `- Высота потолка: ${hints.ceiling_height_m} м` : ''}

Используй эти данные как РЕФЕРЕНС для проверки своих извлечённых значений. 
Если твои измерения отличаются более чем на 10%, обязательно укажи это в notes.`
}

// ============================================
// Промпт для уточнения данных (если нужно)
// ============================================

export const PROMPT_CLARIFICATION = `На основе предыдущего анализа плана, уточни следующие параметры:
1. Точное количество электроточек (розетки, выключатели, светильники)
2. Точное количество сантехнических точек (краны, унитазы, душевые и т.д.)
3. Площади зон укладки плитки (пол и стены отдельно)
4. Площади стен под покраску
5. Длина плинтусов

Возвращай JSON в формате:
{
  "electric_points": число,
  "plumbing_points": число,
  "tile_floor_m2": число,
  "tile_walls_m2": число,
  "paint_walls_m2": число,
  "baseboard_m": число,
  "confidence": "high" | "medium" | "low",
  "notes": "комментарии о точности оценки"
}`

